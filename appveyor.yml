version: 1.0.{build}
build: off

environment:
  CONDA_ENV_NAME: conda-pack-build

install:
  - set PATH=C:\Miniconda3-x64;C:\Miniconda3-x64\Scripts;%PATH%
  - conda config --set always_yes yes --set changeps1 no
  - conda update -q conda
  - conda install -c conda-forge conda-pack
  - conda env create -f environment.yml
  - conda list -n %CONDA_ENV_NAME% > package-list.txt
  - conda pack --compress-level 9 --n-threads -1 --exclude "*.pyc" --exclude "*.pyx" --exclude "*.js.map" --name %CONDA_ENV_NAME% --output %CONDA_ENV_NAME%.tar.gz

artifacts:
  - path: $(CONDA_ENV_NAME).tar.gz
    name: Packed Environment
  - path: package-list.txt
    name: Installed Packages (conda list)
